<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='../../static/interface/style.css' rel='stylesheet' type='text/css'>
    <title>MQTT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
</head>

<body>

    <div class="wrapper">
        <span class="sensor" style="opacity: {{opacity1}}"></span>
        <span id="obj1" class="object"></span>
    </div>
    <br>
    <br>
    <br>
    <div class="wrapper">
        <span class="sensor" style="opacity: {{opacity2}}"></span>
        <span id="obj2" class="object"></span>
    </div>
    <br>
    <br>
    <br>
    <div class="wrapper">
        <span class="sensor" style="opacity: {{opacity3}}"></span>
        <span id="obj3" class="object"></span>
    </div>

    <script type="text/javascript">
    const MQTT_HOST = "mqtt.eclipseprojects.io/mqtt";
    const MQTT_PORT = 9001;

    // Create a client instance
    client = new Paho.MQTT.Client(MQTT_HOST, MQTT_PORT, "webpage");

    // set callback handlers
    client.onConnectionLost = onConnectionLost;
    client.onMessageArrived = onMessageArrived;

    // connect the client
    client.connect({onSuccess:onConnect});


    // called when the client connects
    function onConnect() {
    // Once a connection has been made, make a subscription and send a message.
    console.log("onConnect");
    client.subscribe("wrist/data/sensors");
    }

    // called when the client loses its connection
    function onConnectionLost(responseObject) {
    if (responseObject.errorCode !== 0) {
    console.log("onConnectionLost:"+responseObject.errorMessage);
    }
    }

    // called when a message arrives
    function onMessageArrived(message) {
            var payload = message.payloadBytes;
            var data = new Uint8Array(payload);
            var sensor1 = data[data.length-3]
            var sensor2 = data[data.length-2]
            var sensor3 = data[data.length-1]

            document.getElementById('obj1').style.marginLeft = (sensor3/10).toString()+"cm";
            document.getElementById('obj2').style.marginLeft = (sensor2/10).toString()+"cm";
            document.getElementById('obj3').style.marginLeft = (sensor1/10).toString()+"cm";

            console.log(sensor1, sensor2, sensor3);
    }
    </script>
</body>
</html>